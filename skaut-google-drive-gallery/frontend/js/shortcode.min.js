jQuery( function( $ ) {
(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=imagelightbox,i=require("justified-layout");var o=t.n(i);function a(t){return"error"in t}function r(t,e){var i='<div class="sgdg-notice-error"><p><strong>'+e.error_header+"</strong></p><p>"+t.error+"</p>";return void 0!==t.trace&&(i+="<p><strong>"+e.error_trace_header+"</strong></p><p>"+t.trace.replace(/\n/g,"<br>")+"</p>"),i+="</div>"}var n=function(){function t(t,e){this.hash=t,this.name=e}return t.prototype.get=function(){var t=new RegExp("[?&]sgdg-"+this.name+"-"+this.hash+"=(([^&#]*)|&|#|$)").exec(document.location.search);return void 0===(null==t?void 0:t[2])?"":decodeURIComponent(t[2].replace(/\+/g," "))},t.prototype.remove=function(){var t=window.location.search,e=new RegExp("\\?sgdg-"+this.name+"-"+this.hash+"=[^&]*"),i=new RegExp("&sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t&&(t=(t=t.replace(e,"?")).replace(i,"")),window.location.pathname+t},t.prototype.add=function(t){var e=window.location.search,i="sgdg-"+this.name+"-"+this.hash+"="+t,o="?"+i,a=new RegExp("([?&])sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t?(e&&(o=null!==a.exec(e)?e.replace(a,"$1"+i):e+"&"+i),window.location.pathname+o):this.remove()},t}(),s=function(){function t(e,i){var o=this;this.lightbox=t.createEmptyLightbox(),this.hasMore=!1,this.path="",this.lastPage=1,this.loading=!1,this.container=$(e),this.hash=i,this.shortHash=i.substring(0,8),this.pageQueryParameter=new n(this.shortHash,"page"),this.pathQueryParameter=new n(this.shortHash,"path"),this.path=this.pathQueryParameter.get(),this.get(),$(window).on("popstate",(function(){o.init()})),$(window).on("resize",(function(){o.reflow()}))}return t.createEmptyLightbox=function(){return new e.ImageLightbox([],{allowedTypes:"",animationSpeed:parseInt(sgdgShortcodeLocalize.preview_speed,10),activity:"true"===sgdgShortcodeLocalize.preview_activity,arrows:"true"===sgdgShortcodeLocalize.preview_arrows,button:"true"===sgdgShortcodeLocalize.preview_closebutton,fullscreen:!0,gutter:0,history:!0,overlay:!0,caption:"true"===sgdgShortcodeLocalize.preview_captions,quitOnEnd:"true"===sgdgShortcodeLocalize.preview_quitOnEnd})},t.renderMoreButton=function(){return'<div class="sgdg-more-button"><div>'+sgdgShortcodeLocalize.load_more+"</div></div>"},t.prototype.onLightboxNavigation=function(t){var e=$(t).data("sgdg-page"),i=$(t).parent().children().length;history.replaceState(history.state,"",this.pageQueryParameter.add(e)),"true"===sgdgShortcodeLocalize.page_autoload&&this.hasMore&&$(t).index()>=Math.min(i-2,Math.floor(.9*i))&&this.add()},t.prototype.onLightboxQuit=function(){history.replaceState(history.state,"",this.pageQueryParameter.remove())},t.prototype.reflow=function(){var t=this,e=[],i=[];this.container.find(".sgdg-gallery").children().each((function(t,o){$(o).css("display","inline-block");var a=o.firstChild,r=a.naturalWidth/a.naturalHeight;if(0<$(o).find("svg").length){var n=$(o).find("svg")[0].getBBox();r=n.width/n.height}$(o).hasClass("sgdg-grid-square")&&(r=1),isNaN(r)?e[t]=!1:(e[t]=!0,i.push(r)),$(o).css("position","absolute")})),0<i.length&&this.container.find(".sgdg-loading").remove();var a=o()(i,{containerWidth:this.container.find(".sgdg-gallery").width(),containerPadding:{top:10,left:0,right:0,bottom:0},boxSpacing:parseInt(sgdgShortcodeLocalize.grid_spacing),targetRowHeight:parseInt(sgdgShortcodeLocalize.grid_height),targetRowHeightTolerance:.15,edgeCaseMinRowHeight:0}),r=0;this.container.find(".sgdg-gallery").children().each((function(i,o){if(e[i]){var n=a.boxes[r],s=t.container.find(".sgdg-gallery").position();$(o).css("top",n.top+s.top),$(o).css("left",n.left+s.left),$(o).width(n.width),$(o).height(n.height),r++}else $(o).css("display","none")})),this.container.find(".sgdg-gallery").height(a.containerHeight)},t.prototype.reflowTimer=function(){var t=this;d.reflowAll(),this.loading&&setTimeout((function(){t.reflowTimer()}),250)},t.prototype.init=function(){var t=this.pathQueryParameter.get();this.path!==t&&(this.path=t,this.get())},t.prototype.get=function(){var e=this;this.path=this.pathQueryParameter.get(),this.lastPage=parseInt(this.pageQueryParameter.get())||1,this.lightbox=t.createEmptyLightbox(),this.container.find(".sgdg-gallery").replaceWith('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),d.reflowAll(),$.get(sgdgShortcodeLocalize.ajax_url,{action:"gallery",hash:this.hash,path:this.path,page:this.lastPage},(function(t){a(t)?e.container.html(r(t,sgdgShortcodeLocalize)):e.getSuccess(t)}))},t.prototype.getSuccess=function(e){var i,o,a=this,r=((e.directories?e.directories.length:0)+(e.images?e.images.length:0)+(e.videos?e.videos.length:0))/this.lastPage,n="",s=1,d=r;(void 0!==e.path&&0<e.path.length||void 0!==e.directories&&0<e.directories.length)&&(n+=this.renderBreadcrumbs(null!==(i=e.path)&&void 0!==i?i:[])),void 0!==e.directories&&0<e.directories.length||void 0!==e.images&&0<e.images.length||void 0!==e.videos&&0<e.videos.length?(n+='<div class="sgdg-loading"><div></div></div><div class="sgdg-gallery">',e.directories&&$.each(e.directories,(function(t,e){n+=a.renderDirectory(e),0===--d&&(d=r,s++)})),e.images&&$.each(e.images,(function(t,e){n+=a.renderImage(s,e),0===--d&&(d=r,s++)})),e.videos&&$.each(e.videos,(function(t,e){""!==document.createElement("video").canPlayType(e.mimeType)&&(n+=a.renderVideo(s,e)),0===--d&&(d=r,s++)})),n+="</div>",!0===e.more&&(n+=t.renderMoreButton())):n+='<div class="sgdg-gallery">'+sgdgShortcodeLocalize.empty_gallery+"</div>",this.container.html(n),this.hasMore=null!==(o=e.more)&&void 0!==o&&o,this.postLoad(),this.lightbox.openHistory()},t.prototype.add=function(){var t=this;this.lastPage+=1,this.container.find(".sgdg-gallery").after('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),$.get(sgdgShortcodeLocalize.ajax_url,{action:"page",hash:this.hash,path:this.pathQueryParameter.get(),page:this.lastPage},(function(e){if(a(e))return t.container.find(".sgdg-loading").replaceWith(r(e,sgdgShortcodeLocalize)),void t.container.find(".sgdg-more-button").remove();t.addSuccess(e)}))},t.prototype.addSuccess=function(e){var i,o=this,a="";$.each(e.directories,(function(t,e){a+=o.renderDirectory(e)})),$.each(e.images,(function(t,e){a+=o.renderImage(o.lastPage,e)})),$.each(e.videos,(function(t,e){a+=o.renderVideo(o.lastPage,e)})),this.container.find(".sgdg-gallery").append(a),this.hasMore=null!==(i=e.more)&&void 0!==i&&i,!0===e.more&&this.container.append(t.renderMoreButton()),this.container.find(".sgdg-loading").remove(),this.postLoad()},t.prototype.postLoad=function(){var t=this;this.container.find("a[data-sgdg-path]").off("click.sgdg").on("click.sgdg",(function(e){return history.pushState({},"",t.pathQueryParameter.add($(e.currentTarget).data("sgdgPath"))),t.get(),!1})),this.container.find(".sgdg-more-button").on("click",(function(){return t.add(),!1})),this.loading=!0,this.container.find(".sgdg-gallery").imagesLoaded({background:!0},(function(){t.loading=!1,d.reflowAll()})),this.reflowTimer(),this.lightbox.addImages(this.container.find("a[data-imagelightbox]").get()),"true"===sgdgShortcodeLocalize.page_autoload&&$(window).off("scroll.sgdg").on("scroll.sgdg",(function(e){var i=$(".sgdg-more-button"),o=$(e.currentTarget).scrollTop(),a=$(window).height(),r=i.offset(),n=i.outerHeight();void 0!==o&&void 0!==a&&void 0!==r&&void 0!==n&&(o+a>r.top+n&&!t.loading&&t.add())}))},t.prototype.renderBreadcrumbs=function(t){var e=this,i='<div><a data-sgdg-path="" href="'+this.pathQueryParameter.remove()+'">'+sgdgShortcodeLocalize.breadcrumbs_top+"</a>",o="";return $.each(t,(function(t,a){o+=a.id,i+=' > <a data-sgdg-path="'+o+'" href="'+e.pathQueryParameter.add(o)+'">'+a.name+"</a>",o+="/"})),i+="</div>"},t.prototype.renderDirectory=function(t){var e=this.pathQueryParameter.get(),i='<a class="sgdg-grid-a sgdg-grid-square" data-sgdg-path="'+(e=(e?e+"/":"")+t.id)+'" href="'+this.pathQueryParameter.add(e)+'"';if(t.thumbnail?i+=" style=\"background-image: url('"+t.thumbnail+"');\">":i+='><svg class="sgdg-dir-icon" x="0px" y="0px" focusable="false" viewBox="0 0 24 24" fill="#8f8f8f"><path d="M10 4H4c-1.1 0-2 .9-2 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>',i+='<div class="sgdg-dir-overlay"><div class="sgdg-dir-name">'+t.name+"</div>",void 0!==t.dircount&&(i+='<span class="sgdg-count-icon dashicons dashicons-category"></span> '+t.dircount.toString()+(1e3===t.dircount?"+":"")),void 0!==t.imagecount){var o="";void 0!==t.dircount&&(o=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-format-image'+o+'"></span> '+t.imagecount.toString()+(1e3===t.imagecount?"+":"")}if(void 0!==t.videocount){o="";void 0===t.dircount&&void 0===t.imagecount||(o=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-video-alt3'+o+'"></span> '+t.videocount.toString()+(1e3===t.videocount?"+":"")}return i+="</div></a>"},t.prototype.renderImage=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-ilb2-caption="'+e.description+'" data-sgdg-page="'+t.toString()+'" href="'+e.image+'"><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},t.prototype.renderVideo=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-sgdg-page="'+t.toString()+'" data-ilb2-video=\'{ "controls": "controls", "autoplay": "autoplay", "height": '+("number"==typeof e.height?e.height.toString():"0")+', "width": '+("number"==typeof e.width?e.width.toString():"0")+', "sources": [ { "src": "'+e.src+'", "type": "'+e.mimeType+'" } ] }\'><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},t}(),d={shortcodes:{},init:function(){var t=this;$(".sgdg-gallery-container").each((function(e,i){var o=$(i).data("sgdgHash");void 0!==o&&(t.shortcodes[o.substring(0,8)]=new s(i,o))})),$(document).on("start.ilb2 next.ilb2 previous.ilb2",(function(e,i){t.onLightboxNavigation(i)})),$(document).on("quit.ilb2",(function(){t.onLightboxQuit()}))},reflowAll:function(){$.each(this.shortcodes,(function(t,e){e.reflow()}))},onLightboxNavigation:function(t){var e=$(t).data("imagelightbox");this.shortcodes[e].onLightboxNavigation(t)},onLightboxQuit:function(){$.each(this.shortcodes,(function(t,e){e.onLightboxQuit()}))}};d.init()})();} );
